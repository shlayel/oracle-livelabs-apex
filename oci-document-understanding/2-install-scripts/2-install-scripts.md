# Setup Tasks for Application Development

## Introduction

In this lab, you will run SQL commands using SQL Scripts. A SQL script can contain one or more SQL statements or PL/SQL blocks. You can use SQL scripts to create, edit, view, run, and delete database objects.

Furthermore, you'll discover how to create multiple accounts in a single operation.

Moreover, you'll configure Web credentials to authenticate connections to external REST services or REST-Enabled SQL services from APEX.

Estimated Time: 10 Minutes

### Objectives

In this lab, you:

- Create database objects using SQL Scripts
- Create multiple Application Users
- Create Web Credentials

## Task 1: Create database objects using SQL Scripts

1. Log in into your APEX Workspace. Click **'âŒ„'** next to **SQL Workshop** and Select **SQL Scripts**.

    ![Select Quick SQL](images/sql_script.png " ")

2. Click **Create**.

    ![Create Quick SQL](images/create-quick-sql.png " ")

3. Copy the following SQL code and paste it into the code editor:

    ```
    <copy>
    CREATE TABLE "EMPLOYEE_DETAILS" (
    "EMPNO"    NUMBER
        GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 8000 CACHE
        20 NOORDER NOCYCLE NOKEEP
     NOT NULL ENABLE,
    "EMP_NAME" VARCHAR2(100),
    "MGR"      NUMBER(4, 0),
    CONSTRAINT "EMP_PK" PRIMARY KEY ( "EMPNO" )
    );

   INSERT INTO EMPLOYEE_DETAILS (
    EMPNO,
    EMP_NAME,
    MGR
      ) VALUES (
    10,
    'JOHN',
    20
    );

   INSERT INTO EMPLOYEE_DETAILS (
    EMPNO,
    EMP_NAME,
    MGR
       ) VALUES (
    20,
    'CLARA',
    30
    );

    INSERT INTO EMPLOYEE_DETAILS (
    EMPNO,
    EMP_NAME,
    MGR
     ) VALUES (
    30,
    'JANE',
    40
    );

    INSERT INTO EMPLOYEE_DETAILS (
    EMPNO,
    EMP_NAME,
    MGR
     ) VALUES (
    40,
    'MATT',
    NULL
    );

    COMMIT;

    /

    CREATE TABLE "INV_UPLOAD" (
    "ID"                 NUMBER
        GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20
        NOORDER NOCYCLE NOKEEP NOSCALE
    NOT NULL ENABLE,
    "FILE_NAME"          VARCHAR2(4000 CHAR),
    "MIME_TYPE"          VARCHAR2(4000 CHAR),
    "OBJECT_STORAGE_URL" VARCHAR2(4000 CHAR),
    "CREATED"            DATE NOT NULL ENABLE,
    "CREATED_BY"         VARCHAR2(255 CHAR) NOT NULL ENABLE,
    "UPDATED"            DATE NOT NULL ENABLE,
    "UPDATED_BY"         VARCHAR2(255 CHAR) NOT NULL ENABLE,
    "STATUS"             VARCHAR2(50) DEFAULT 'Pending Approval',
    "DOC_AI_JSON"        CLOB,
    CONSTRAINT "INV_UPLOAD_ID_PK" PRIMARY KEY ( "ID" )
        USING INDEX ENABLE
     );

    CREATE OR REPLACE EDITIONABLE TRIGGER "INV_UPLOAD_BIU" BEFORE
    INSERT OR UPDATE ON INV_UPLOAD
    FOR EACH ROW
    BEGIN
    IF INSERTING THEN
        :NEW.CREATED := SYSDATE;
        :NEW.CREATED_BY := COALESCE(SYS_CONTEXT('APEX$SESSION', 'APP_USER'),
                                   USER);
    END IF;

    :NEW.UPDATED := SYSDATE;
    :NEW.UPDATED_BY := COALESCE(SYS_CONTEXT('APEX$SESSION', 'APP_USER'),USER);
    END INV_UPLOAD_BIU;
    /

    ALTER TRIGGER "INV_UPLOAD_BIU" ENABLE;

    /

    CREATE TABLE "DOCAI_RESPONSE" (
    "ID"              NUMBER
        GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20
        NOORDER NOCYCLE NOKEEP NOSCALE
    NOT NULL ENABLE,
    "DOCUMENT_ID"     NUMBER,
    "FIELD_TYPE_CODE" VARCHAR2(4000 CHAR),
    "FIELD_LABEL"     VARCHAR2(4000 CHAR),
    "LABEL_SCORE"     VARCHAR2(4000 CHAR),
    "FIELD_VALUE"     VARCHAR2(4000 CHAR),
    "CREATED"         DATE NOT NULL ENABLE,
    "CREATED_BY"      VARCHAR2(255 CHAR) NOT NULL ENABLE,
    "UPDATED"         DATE NOT NULL ENABLE,
    "UPDATED_BY"      VARCHAR2(255 CHAR) NOT NULL ENABLE,
    CONSTRAINT "DOCAI_RESPONSE_ID_PK" PRIMARY KEY ( "ID" )
        USING INDEX ENABLE
     );

    CREATE OR REPLACE EDITIONABLE TRIGGER "DOCAI_RESPONSE_BIU" BEFORE
    INSERT OR UPDATE ON DOCAI_RESPONSE
    FOR EACH ROW
    BEGIN
    IF INSERTING THEN
        :NEW.CREATED := SYSDATE;
        :NEW.CREATED_BY := COALESCE(SYS_CONTEXT('APEX$SESSION', 'APP_USER'),
                                   USER);
    END IF;

    :NEW.UPDATED := SYSDATE;
    :NEW.UPDATED_BY := COALESCE(SYS_CONTEXT('APEX$SESSION', 'APP_USER'),USER);
    END DOCAI_RESPONSE_BIU;
    /

    ALTER TRIGGER "DOCAI_RESPONSE_BIU" ENABLE;

    /

    CREATE OR REPLACE PROCEDURE UPLOAD_FILE (
    P_FILE_CONTENT       IN VARCHAR2,
    P_STATIC_ID          IN VARCHAR2,
    P_NAMESPACE          IN VARCHAR2,
    P_BUCKET             IN VARCHAR2,
    P_REGION             IN VARCHAR2,
    P_OBJECT_STORAGE_URL OUT VARCHAR2,
    P_FILE_NAME          OUT VARCHAR2,
    P_MIME_TYPE          OUT VARCHAR2
    ) IS
    L_OBJECT   BLOB;
    L_RESPONSE CLOB;
    BEGIN
    SELECT
        BLOB_CONTENT,
        FILENAME,
        MIME_TYPE
    INTO
        L_OBJECT,
        P_FILE_NAME,
        P_MIME_TYPE
    FROM
        APEX_APPLICATION_TEMP_FILES
    WHERE
        NAME = P_FILE_CONTENT;

    P_OBJECT_STORAGE_URL := 'https://objectstorage.'
                            || P_REGION
                            || '.oraclecloud.com/n/'
                            || P_NAMESPACE
                            || '/b/'
                            || P_BUCKET
                            || '/o/'
                            || P_FILE_NAME;

    APEX_WEB_SERVICE.G_REQUEST_HEADERS(1).NAME := 'Content-Type';
    APEX_WEB_SERVICE.G_REQUEST_HEADERS(1).VALUE := P_MIME_TYPE;
    L_RESPONSE := APEX_WEB_SERVICE.MAKE_REST_REQUEST(P_URL => P_OBJECT_STORAGE_URL, P_HTTP_METHOD => 'PUT', P_BODY_BLOB => L_OBJECT, P_CREDENTIAL_STATIC_ID => P_STATIC_ID
    );

    IF APEX_WEB_SERVICE.G_STATUS_CODE != 200 THEN
        RAISE_APPLICATION_ERROR(-20000, 'Upload failed - ' || APEX_WEB_SERVICE.G_STATUS_CODE);
    END IF;

    END UPLOAD_FILE;

     </copy>
    ```

4. For **Script Name**: Enter **Application Scripts** and click **Run**.

   ![Script Name](./images/script-name.png " ")

5. On the Run Script page, click **Run Now**.

    ![Run Now](images/run-now.png " ")

6. The Results page shows the results of running the script. Scroll to the bottom to see a summary. You should not see any errors.

    ![SQL Script Results](images/successful.png " ")

## Task 2: Create Multiple Application Users

Workspace administrators can create new user accounts one at a time or create multiple accounts in a single operation.

To create multiple users accounts simultaneously:

1. At the top of the Workspace home page, under Administration, click **Manage Users and Groups**.

   ![Administration](images/manage-users.png " ")

2. Click **Create Multiple Users**.

   ![Create Multiple Users](images/create-multiple-users.png " ")

3. Enter/select the following details:

    - List of Email Addresses: **MATT@xyz.com, JANE@xyz.com, CLARA@xyz.com, JOHN@xyz.com**

    - Usernames: **Exclude @ domain as part of the username**

    Under Password:

      - Password: Specify a password

      - Confirm Password: Enter the password again.

    Click **Next**.

    ![Create Multiple Users](images/create-users-next1.png " ")

4. Click **Create Valid Users**.

    ![Create Valid User](images/create-valid-users.png " ")

## Task 3: Create Web Credentials in Oracle APEX

Web credentials authenticate the connection to external REST services or REST-Enabled SQL services from APEX.

Creating Web Credentials securely stores and encrypts authentication credentials for use by Oracle APEX components and APIs. Credentials cannot be retrieved back in clear text. They are stored at the workspace level and, therefore, visible to all applications.

To create a Web Credential in Oracle APEX:

1. On the Workspace home page, click **App Builder**.

   ![Click App Builder](images/app-build5.png " ")

2. Click **Workspace Utilities**.

   ![Click Workspace Utilities](images/workspace-utilities.png " ")

3. Select **Web Credentials**.

   ![Click Web Credentials](images/web-credentials.png " ")

4. Click **Create**.

   ![Create Web Credentials](images/create-web-creds.png " ")

5. Enter/select the following details using the configuration file you copied in the previous task.

    - Name: **APEX\_OCI\_AI\_CRED**

    - Static ID: **APEX\_OCI\_AI\_CRED**

    - Authentication Type: **OCI Native Authentication**

    - OCI User ID: Enter the OCID of the Oracle Cloud user Account. The OCID is in the Configuration File Preview generated during the API Key creation.
    Copy and paste your OCI User ID 
    
    ```
    <copy>
    ocid1.user.oc9..aaaaaaaa36nkz74s6wx2dyoxfhiiwokltup5sf2ue5lvosrvwa2r5kbjmwca
    </copy>
    ```

    - OCI Private Key: Copy and paste the API Key.

    ```
    <copy>
    MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDb3Fw9o7GMxSAB
    ZXUgZti9RfWzdonjs9IYNbhh+m7aJGT8ut2y0f+6n805NEo0GERt2I9D3RAioKJG
    ZENAUjfHZ8uSTbrDaD6xAX0r7djk31X/3whJTxg1cVyn4MvOotZfnkijuJptX/8w
    5CbNeBCkqhU6SBkEbWUDZdLlrrD4HubKd2svcwQxcb8rppMwBFc9H22W9sAzOX07
    6t0w/G+lvxbRo9DJao5efC+2t46Fzewyu+atMqBbNHsjtsL8arpKOEOPthXLV9GO
    59uM/LQ2GB04QrhqJPCL5ssIAUj/oYkhQ3ZunMYS6z02o1GOz9TYd25icWoe+N3y
    YESxRnGdAgMBAAECggEABZi5J1+Gmj79VtPClMHRdBX3EGuszGVMLI4XhLT3g+mH
    wZAvKwlh8Vn2gyWD2wogGcy4ruFOcxc0MkcEmDtPjK2ldrKwVZ+OcvqG+WqLSh4u
    Rf5jK1yOUPPzCBn2jirCerogfrxo/+5A5Hl2TGYpREvJEQv7SQvQ1bKOmQamnhY9
    NDThSlen4qPL09V5JJqVEArD1Kz4mk9FLOCm2G6swn0Ns6uA87Jlde+oVuIfaUnl
    m3f/rRuxwcoN10PUWY0mjaWfct3P4GHKQRMe0xZYeSCzbkBz3Sw6t9BaO66lfPuG
    St4xk9PgW97eBoEDJWIit6kDYJCRla1ukPcxhP6HYQKBgQDzUG+uRnuzA1YSYFfu
    /OHmTSYciPWUgVNWxpViQ+cbzCYqECI9jxtUVIiK16nZ2RS003bfj+A/Ji4cbUl8
    Fl8h2LUi5YJGL4aA0SH/gXJc+twzSABc2a/euSLMp9CuCAv3TCxcDHxZFu/Yqytl
    gMJ8OwF5rNjzSvEZd2N5oFFhfQKBgQDnUuLyn4vnDzxnc4YKu9Piqo/zkmOlQ6li
    eYDzQno7inGSrq0s/xl0h9e/8x+dXP6/PPTTYlG/i63Ev8Ls1tpvimIU9zJHCwIN
    +Jp8X3QoR0q2k7SzoLWJgs4dSpwS6QEPfVEKWBUeQ0Pgod3yNYX76/SgaaTe/GLh
    xH2U+7JKoQKBgB3eOOdu1Y6DEVTOKN04g86Ol+gW0/a37XAQjpPye/NIm0K8mkdu
    Qs+WVPCeSsZoRIdyEfydn8yAtlZdABFQebsg7BNtkxFkkiFMCt1fmZdaYB+Xbhv3
    yQQRO/ldfFtwt29TFXrzOWyCSU0SrhAWv0kawTKbikJLZ89VfYuXp4XNAoGBALHn
    4lkc8XkEE72wcF+i8yN5b/qxFGfO8N+meNEdyGowYIaiRte7XfVsYDblIeRh2B52
    IAjOrfZ102/k12JVH2v3btWXBBj1U2AxWYbb1rb/lWtzj98yc0vNyP1oGz7D6qfi
    BkjBU4SR0QtbEhospd4JK3uPpFhGnTnrZ3YEWavhAoGBAIGaL0/wqzCrUG7VUE6w
    mch3E9w0eOSZK2qYVZcCgt0zNFELjktHjxqcKfiryQv7RqxJzq/8w74xX22PQADT
    IKiExDyset22HqF5YN/TphuiJyg+3/RLHqakxc10kjhm6cLDv2CtIkWAHJwt7xZE
    YeYhzDiVPyahePzHK1G5mZk9
    </copy>
    ```

    - OCI Tenancy ID: Enter the OCID for Tenancy. Copy and paste your Tenancy ID
    
    ```
    <copy>
    ocid1.tenancy.oc9..aaaaaaaallxmjuq5chlnz365sidyq2smzy2lghygwq4alcrlgs3b2znibmsq
    </copy>
    ```

    - OCI Public Key Fingerprint: Enter the Fingerprint ID. Copy and paste your Fingerprint ID
    
    ```
    <copy>
    f4:29:61:c9:6a:74:f5:18:59:06:cd:0f:4c:41:34:36
    </copy>
    ```

   ![Web Credentials page](images/web-creds1.png " ")

6. Click **Create**.

   ![Web Credentials page](images/web-creds-created.png " ")

## Summary

You've gained the skills to create database objects using SQL Scripts, create multiple application users, and set up web credentials.

You're now ready to move on to the next lab!

## Acknowledgements

- **Author** - Roopesh Thokala, Senior Product Manager ; Ankita Beri, Product Manager
- **Last Updated By/Date** - Ankita Beri, Product Manager, June 2024
